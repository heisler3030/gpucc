<h2>Missed Workouts for <%= @ca.user.name %>, <%= link_to @ca.challenge.title, @ca.challenge %></h2>

<% @missed_workout_activities.each_with_index do |mw, i| %>

  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="row">
        <div class="col-md-6"><h3><%= i+1 %> - <%= mw.workout.effective_date %></h3></div>
        <div class="col-md-6 text-right"><%= link_to "Edit Sets", nil, :onClick => "editCompletedSet(#{mw}); return false;" %> | <%= link_to "Grant Exclusion", nil, :onClick => "createExclusion(#{@ca.user.id}, #{mw.workout.id}); return false;" %></div>
      </div>
    </div>
    <div class="panel-body">
      <div class="row">


        <div class="col-sm-6">
          <table class="table table-condensed">
            <tbody>
            <% mw.workout_exercises.each do |we| %>

              <%# Calculate Percent Complete (have to force floating point) %>
              <% pct_complete = ((mw.count_reps(we.exercise).to_f/we.goal) * 100).to_i %>
              <% progress_status = pct_complete >= 100 ? "progress-bar progress-bar-success" : "progress-bar" %>
              <% progress_width = pct_complete >= 100 ? 100 : pct_complete %>

              <%# Should probably turn all this into an ExerciseHelper to start to include things like time remaining for progress bar color %>

              <tr>
                <td class="align-middle"><%= we.exercise.name %></td>
                <td class="align-middle"><%= mw.count_reps(we.exercise) %> <b>/</b> <%= we.goal %></td>
                <td class="align-middle" width="40%">
                  <div class="progress" >
                    <%= content_tag :div, {class: "#{progress_status}", role: "progressbar",  aria: {valuenow: "#{pct_complete}", valuemin: "0", valuemax: "100"}, style: "width: #{progress_width}%;"} do %>
                      <p class="bar"><%= pct_complete %>%</p>
                    <% end %>
                  </div>
                </td>
              </tr>

            <% end %>
            </tbody>
          </table>
        </div>

        <div class="col-sm-6">
          <table class="table">
            <thead>
              <tr>
                <th>Exercise</th>
                <th>Reps</th>
                <th>Local Time</th>
              </tr>
            </thead>
            <tbody>
              <% mw.completed_sets.each do |cs| %>
                <tr class="completed_set">
                  <td><%= cs.exercise.name %></td>
                  <td><%= cs.reps %></td>
                  <td><%= cs.complete_time.in_time_zone(cs.user.time_zone).strftime("%l:%M %p %Z") %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

      </div> <%# End of Row %>
    </div> <%# End of Panel body %>
  </div> <%# End of Panel %>

<% end %>

<% if @missed_workout_activities.size == 0 %>
<em>No Workouts found</em>
<% end %>

<h2>Manager Exclusions</h2>

<% @mgr_exclusions.each_with_index do |ew, i| %>

  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="row">
        <div class="col-md-6"><h3><%= i+1 %> - <%= ew.workout.effective_date %></h3></div>
        <div class="col-md-6 text-right"><%= link_to "Cancel Exclusion", nil %></div>
      </div>
    </div>
    <div class="panel-body">
      <div class="row">

      <%= ew.workout.effective_date %>
      <%= ew.override_comment %>

      </div> <%# End of Row %>
    </div> <%# End of Panel body %>
  </div> <%# End of Panel %>

<% end %>

<% if @missed_workout_activities.size == 0 %>
<em>No Workouts found</em>
<% end %>


<%#- Modal Edit window - populated by AJAX %>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      ...
    </div>
  </div>
</div>